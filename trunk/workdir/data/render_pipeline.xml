<render_pipeline>
	<begin_render name="begin_render_main_loop"/>
	<set_depth_stencil_state name="stencil_state_z4" enable_z_test = "true"  write_z_buffer = "true" enable_stencil = "false" comparison_func = "4"/>
	<set_rasterizer_state name="set_rasterizer_state" cull_mode="front" clock_wise="1" type="solid"/> <!-- type  -->
	
	<set_per_frame_constants name="set_per_frame_cmd"/>
	
	<set_render_target name="deferred_multiple_render_target">
		<dynamic_texture name="AlbedoTexture" texture_width_as_frame_buffer="true" create_depth_stencil_buffer="false" format="RGBA8_UNORM"/>
		<dynamic_texture name="LightMapTexture" texture_width_as_frame_buffer="true" format="RGBA8_UNORM"/>
		<dynamic_texture name="NormalMapTexture" texture_width_as_frame_buffer="true" format="RGBA8_UNORM"/>
		<dynamic_texture name="DepthMapTexture" texture_width_as_frame_buffer="true" format="R32_FLOAT"/>
	</set_render_target>	
	<clear name="clear_deferred" render_target="true" depth_stencil="true" color="0.0 0.0 0.0 0.0"/>
	<set_depth_stencil_state name="ar" enable_z_test="true"  write_z_buffer = "true" enable_stencil = "false" comparison_func = "4"/>
	<apply_technique_pool name="apply_deferred_technique" pool_name="deferred"/>
	<render_layer name="render_deferred_opaque" layer="deferred_opaque"/>
	<unset_render_target name="unset_render_target"/>
		
	<apply_technique_pool name="apply_quad_technique" pool_name="quad"/>
	<set_depth_stencil_state name="stencil_state_z2" enable_z_test="false" write_z_buffer="false" enable_stencil="false"/>
	<draw_quad name="deffered_shading_lighting" material="DrawQuadDeferredShadingMaterial">
        <texture name="LightMapTexture" stage_id="0"/>
    </draw_quad>
	
	<set_depth_stencil_state name="stencil_state_z3" enable_z_test="true"  write_z_buffer = "true" enable_stencil = "false" comparison_func = "4"/>
	
	<apply_technique_pool name="apply_forward_technique" pool_name="forward"/>	
	<render_layer name="render_bodegon_principal" layer="Principal"/>
	
	<apply_technique_pool name="apply_skybox_technique" pool_name="skybox"/>
	<render_layer name="render_bodegon_skybox" layer="Skybox"/>

	
	<!--	<capture_frame_buffer name="capture_frame_buffer" texture_width_as_frame_buffer="true" /> -->

	<set_depth_stencil_state name="stencil_state_z3" enable_z_test="false" write_z_buffer="false" enable_stencil="false"/>

	<apply_technique_pool name="apply_post_process_technique" pool_name="post_process"/>
			
	FOG
	<!--
	<draw_quad material="FogMaterial"  viewport_position = "0 0" viewport_size = "128 128">
		<texture name="capture_frame_buffer" stage="0"/>
		<texture name="DepthMapTexture" stage="1"/>
	</draw_quad>
	 -->
	 
	<enable_alpha_blend/>	
	<draw_quad name="noise_vignetting" material="NoiseVignettingMaterial">
		<texture name="noise" />
		<texture name="vignetting" />
	</draw_quad>	
	<disable_alpha_blend/>
	
	<!--
	<apply_technique_pool name="apply_quad_technique2" pool_name="quad"/>
	
	<draw_quad name="deffered_shading_lighting2" material="DrawQuadDeferredShadingMaterial"  viewport_position = "0 0" viewport_size = "128 128">
        <texture name="AlbedoTexture" stage_id="0"/>
    </draw_quad>
	<draw_quad name="deffered_shading_lighting3" material="DrawQuadDeferredShadingMaterial"  viewport_position = "129 0" viewport_size = "128 128">
        <texture name="NormalMapTexture" stage_id="0"/>
    </draw_quad>
	<draw_quad name="deffered_shading_lighting4" material="DrawQuadDeferredShadingMaterial"  viewport_position = "0 129" viewport_size = "128 128">
        <texture name="DepthMapTexture" stage_id="0"/>
    </draw_quad>
	-->
	
	<!--		
	<draw_quad material="NoiseAndVignettingMaterial">
	<texture stage="0" name="Data/GUI/textures/noise.dds"/>
	<texture stage="1" name="Data/GUI/textures/vignetting.dds"/>
	</draw_quad>
	
	<apply_technique_pool name="apply_forward_technique" pool_name="Skybox"/>	
		<render_layer name="render_opaque" layer="opaque"/>
		<render_layer name="render_lights" layer="lights"/>	
		<set_render_target name="deferred_multiple_render_target">
		<dynamic_texture name = "DiffuseMapTexture" texture_width_as_frame_buffer = "true" create_depth_stencil_buffer = "false" format_type = "RGBA8_UNORM" / >
		<dynamic_texture name = "LightMapTexture" texture_width_as_frame_buffer = "true" format_type = "RGBA8_UNORM" / >
		<dynamic_texture name = "NormalMapTexture" texture_width_as_frame_buffer = "true" format_type = "R8G8B8A8_UNORM" / >
		<dynamic_texture name = "DepthMapTexture" texture_width_as_frame_buffer = "true" format_type = "R32_FLOAT" / > 
		<texture stage_id="0" file="DiffuseMapTexture"/>
	</set_render_target>-->
	<!--<capture_frame_buffer> 
		<capture_texture name="DeferredCapturedTexture" texture_width_as_frame_buffer="true"/>
	</capture_frame_buffer>
	<set_alpha_blend_state name ="set_alpha_blend_state" state="enabled" src_blend="SrcAlpha" dst_blend="InvSrcAlpha" blend_op="add" src_blend_alpha="blend_one" dst_blend_alpha="blend_one" blend_op_alpha="add"  render_target_write_mask="all" />
	-->
	
	<render_imgui name="imediate_gui_render"/>
	<end_render name="end_render_main_loop"/>
</render_pipeline>